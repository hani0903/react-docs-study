# Effectì˜ ì˜ì¡´ì„± ì œê±°í•˜ê¸°

ì˜ì¡´ì„±ì€ ì„ íƒí•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ **Effect ë‚´ë¶€ì˜ ì½”ë“œì— ì˜í•´ ìë™ìœ¼ë¡œ ê²°ì •**ëœë‹¤.

> Effectì˜ ì½”ë“œ ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ëŠ” **ëª¨ë“  ë°˜ì‘í˜• ê°’**ì€ ì˜ì¡´ì„± ëª©ë¡ì— í¬í•¨ë˜ì–´ì•¼ í•œë‹¤.

## ì˜ì¡´ì„± ë³€ê²½ í”„ë¡œì„¸ìŠ¤

> **1. ì½”ë“œ ë¨¼ì € ë³€ê²½:** Effect ë‚´ë¶€ì˜ ì½”ë“œë‚˜ ë°˜ì‘í˜• ê°’ì˜ ì„ ì–¸ ë°©ì‹ì„ ìˆ˜ì •í•œë‹¤.
> **2. ì˜ì¡´ì„± ì¡°ì •:** ë³€ê²½ëœ ì½”ë“œì— ë§ì¶° ì˜ì¡´ì„± ë°°ì—´ì„ ì—…ë°ì´íŠ¸í•œë‹¤.
> **3. ì˜ì¡´ì„± ì¡°ì •:** ì˜ì¡´ì„± ëª©ë¡ì´ ë§Œì¡±ìŠ¤ëŸ½ì§€ ì•Šë‹¤ë©´ 1ë‹¨ê³„ë¡œ ëŒì•„ê°€ ì½”ë“œë¥¼ ë‹¤ì‹œ ìˆ˜ì •í•œë‹¤.

## ì˜ì¡´ì„± ë¦°í„° ì–µì œì˜ ìœ„í—˜ì„±

ë¦°í„°ê°€ ì˜ì¡´ì„± ëª©ë¡ì— í¬í•¨ë ê±°ë¼ ì˜ˆì¸¡í•˜ëŠ” ê°’ë“¤ì€ ì‹¤ì œë¡œ í¬í•¨ë˜ì–´ì•¼ í•˜ëŠ” ê°’ë“¤ì´ë‹¤. ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì˜ì¡´ì„± ë¦°í„°ë¥¼ ì–µì œí•˜ë©´ ë²„ê·¸ê°€ ë°œìƒí•  í™•ë¥ ì´ ë†’ë‹¤.

```jsx
useEffect(() => {
    // ...
    // ğŸ”´ Avoid suppressing the linter like this:
    // eslint-ignore-next-line react-hooks/exhaustive-deps
}, []);
```

### ì‹¤ì œ ë²„ê·¸ ì‚¬ë¡€

```jsx
export default function Timer() {
  const [count, setCount] = useState(0);
  const [increment, setIncrement] = useState(1);

  function onTick() {
    setCount(count + increment); // í´ë¡œì €ë¡œ ì¸í•œ stale closure ë¬¸ì œê°€ ë°œìƒí•¨
  }

  useEffect(() => {
    const id = setInterval(onTick, 1000);
    return () => clearInterval(id);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);
  ...
  return<div>{count}</div>
}
```

**ë¬¸ì œì **

-   ì²« ë Œë”ë§ ì‹œ `onTick`ì€ `count = 0`, `increment = 1`ì„ ìº¡ì²˜í•œë‹¤.
    -   ë”°ë¼ì„œ `setCount(0 + 1)`ì„ ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
-   ì´í›„ ë Œë”ë§ì—ì„œ `onClick` í•¸ë“¤ëŸ¬ëŠ” ìƒˆë¡œ ìƒì„±ë˜ì§€ë§Œ, EffectëŠ” ìƒˆë¡œ ìƒì„±ëœ í•¨ìˆ˜ê°€ ì•„ë‹Œ ì´ˆê¸° í•¨ìˆ˜ë¥¼ ê³„ì† ì°¸ì¡°í•œë‹¤.
-   ê²°ê³¼ì ìœ¼ë¡œ `count`ê°’ì€ 1ì—ì„œ ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤.

## ë¶ˆí•„ìš”í•œ ì˜ì¡´ì„± ì œê±° ì „ëµ

### Effect ë‚´ë¶€ì—ì„œ State ì—…ë°ì´íŠ¸í•˜ê¸°

#### ë¬¸ì œê°€ ìˆëŠ” ì½”ë“œ

```jsx
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      setMessages([...messages, receivedMessage]);
    });
    return () => connection.disconnect();
  }, [roomId, messages]); // âœ… All dependencies declared
  // ...
```

Effect ë‚´ë¶€ì—ì„œ `roomId`ì™€ `messages`ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì˜ì¡´ì„± ë°°ì—´ì—ëŠ” ë°˜ë“œì‹œ ë‘ ë°˜ì‘í˜• ê°’ì´ í¬í•¨ë˜ì–´ì•¼ í•œë‹¤.

> **ë¬¸ì œì âš ï¸**
>
> `message`ê°€ ì˜ì¡´ì„±ì— í¬í•¨ë˜ë©´ì„œ ìƒˆ ë©”ì„¸ì§€ê°€ ì „ì†¡ë  ë•Œë§ˆë‹¤ ì±„íŒ…ì´ ë‹¤ì‹œ ì—°ê²°ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒ!

#### ì—…ë°ì´í„° í•¨ìˆ˜ë¥¼ í†µí•´ í•´ê²°

```jsx
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      setMessages(msgs => [...msgs, receivedMessage]);
    });
    return () => connection.disconnect();
  }, [roomId]); // âœ… All dependencies declared
  // ...
```

**ì—…ë°ì´í„° í•¨ìˆ˜**ë¥¼ setter í•¨ìˆ˜ì— ì „ë‹¬í•¨ìœ¼ë¡œì¨ ì´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

### Propsë¡œ ê°ì²´ë¥¼ ë°›ëŠ” ë°©ë²•

#### ë¬¸ì œ ìƒí™©

```jsx
function ChatRoom({ options }) {
  const [message, setMessage] = useState('');

  useEffect(() => {
    const connection = createConnection(options);
    connection.connect();
    return () => connection.disconnect();
  }, [options]); // âœ… All dependencies declared
  // ...
```

```jsx
<ChatRoom
    roomId={roomId}
    options={{
        serverUrl: serverUrl,
        roomId: roomId,
    }}
/>
```

ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ê°€ ê°ì²´ë¥¼ ìƒì„±í•œ ë’¤, ê·¸ ê°ì²´ë¥¼ propsë¡œ ìì‹ì—ê²Œ ë„˜ê²¨ì£¼ëŠ” ê²½ìš°ê°€ ìˆë‹¤. ì´ ë•Œ ë§Œì•½ ë¶€ëª¨ê°€ ë Œë”ë§ ì¤‘ì— ê°ì²´ë¥¼ ìƒì„±í•œë‹¤ë©´, ì´ ê°’ì„ ìì‹ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•˜ëŠ” ê±´ ì¢‹ì§€ ì•Šë‹¤.

> ë‚´ìš©ì€ ê°™ì•„ë„ ì°¸ì¡°ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ë¦¬ë Œë”ë§í•  ë•Œë§ˆë‹¤ Effectê°€ ì¬ì—°ê²°ë  ìˆ˜ê°€ ìˆë‹¤.

ReactëŠ” `Object.is()`ë¥¼ ì‚¬ìš©í•´ì„œ ì˜ì¡´ì„±ì„ ë¹„êµí•˜ëŠ”ë°, **ê°ì²´ ë¹„êµ**ì™€ **ì›ì‹œê°’ ë¹„êµ**ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì°¨ì´ë¥¼ ê°–ëŠ”ë‹¤.

##### ê°ì²´

```jsx
// ë Œë”ë§ 1
const options1 = { serverUrl: 'localhost', roomId: 'general' };

// ë Œë”ë§ 2 (ë‚´ìš©ì€ ê°™ì§€ë§Œ ìƒˆë¡œìš´ ê°ì²´)
const options2 = { serverUrl: 'localhost', roomId: 'general' };

Object.is(options1, options2); // false â†’ Effect ì¬ì‹¤í–‰!
```

##### ì›ì‹œê°’

```jsx
// ë Œë”ë§ 1
const roomId1 = 'general';
const serverUrl1 = 'localhost';

// ë Œë”ë§ 2
const roomId2 = 'general';
const serverUrl2 = 'localhost';

Object.is(roomId1, roomId2); // true
Object.is(serverUrl1, serverUrl2); // true
// â†’ Effect ì¬ì‹¤í–‰ ì•ˆë¨!
```

#### í•´ê²° ë°©ë²•

```jsx
function ChatRoom({ options }) {
  const [message, setMessage] = useState('');

  const { roomId, serverUrl } = options;
  useEffect(() => {
    const connection = createConnection({
      roomId: roomId,
      serverUrl: serverUrl
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, serverUrl]); // âœ… All dependencies declared
  // ...
```

-   ì´ë ‡ê²Œ í•˜ë©´ ì°¸ì¡°ê°€ ì•„ë‹Œ ê° ê°’ ìì²´ë¥¼ ë¹„êµí•˜ê²Œ ë˜ë¯€ë¡œ ë¶€ëª¨ê°€ ë¦¬ë Œë”ë§ ë  ë•Œë§ˆë‹¤ Effectê°€ ì‹¤í–‰ë˜ëŠ” ê±¸ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.

### ê°ì²´ì™€ í•¨ìˆ˜ ì˜ì¡´ì„± ë¬¸ì œ í•´ê²°

í•¨ìˆ˜ì—ì„œë„ ê°ì²´ì™€ ë™ì¼í•˜ê²Œ ì°¸ì¡°ë¥¼ ë¹„êµí•˜ê²Œ ëœë‹¤.

```jsx
// ë§¤ë²ˆ ìƒˆë¡œìš´ í•¨ìˆ˜ê°€ ìƒì„±ë¨
const func1 = () => {
    return 'hello';
};
const func2 = () => {
    return 'hello';
};

console.log(func1 === func2); // false - ë‚´ìš©ì´ ê°™ì•„ë„ ì°¸ì¡°ê°€ ë‹¤ë¦„
```

#### ë¬¸ì œ ìƒí™©

```jsx
<ChatRoom
    roomId={roomId}
    getOptions={() => {
        return {
            serverUrl: serverUrl,
            roomId: roomId,
        };
    }}
/>
```

ë”°ë¼ì„œ ë¶€ëª¨ê°€ ë¦¬ë Œë”ë§ë  ë•Œë§ˆë‹¤ í•¨ìˆ˜ê°€ ìƒˆë¡œ ìƒì„±ëœë‹¤.

#### í•´ê²° ë°©ë²•1

```jsx
function ChatRoom({ getOptions }) {
    const [message, setMessage] = useState('');

    // âœ… ë Œë”ë§ ì‹œì ì— í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì„œ ê°’ ì¶”ì¶œ
    const { roomId, serverUrl } = getOptions();

    useEffect(() => {
        const connection = createConnection({
            roomId, // ì›ì‹œê°’
            serverUrl, // ì›ì‹œê°’
        });
        connection.connect();
        return () => connection.disconnect();
    }, [roomId, serverUrl]); // âœ… í•¨ìˆ˜ê°€ ì•„ë‹Œ ì›ì‹œê°’ì„ ì˜ì¡´ì„±ìœ¼ë¡œ ì‚¬ìš©
}
```

ë¶€ëª¨ê°€ ì „ë‹¬í•œ í•¨ìˆ˜ë¥¼ **Effect ì™¸ë¶€ì—ì„œ í˜¸ì¶œ**íˆë©´ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

> ë‹¨, í•´ë‹¹ í•¨ìˆ˜ê°€ **ìˆœìˆ˜ í•¨ìˆ˜**ì—¬ì•¼ í•˜ê³ , ë Œë”ë§ ì¤‘ í˜¸ì¶œí•´ë„ ì•ˆì „í•´ì•¼ í•œë‹¤!

#### í•´ê²° ë°©ë²•2

ë˜ëŠ” ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ í•¨ìˆ˜ë¥¼ ìƒì„±í•  ë•Œ `useCallback`í›…ì„ ì‚¬ìš©í•´ ìƒì„±í•˜ê³  ìì‹ì—ê²Œ ì „ë‹¬í•´ì£¼ëŠ” ë°©ë²•ë„ ìˆë‹¤.

```jsx
function ParentComponent() {
    const [roomId, setRoomId] = useState('general');
    const [serverUrl, setServerUrl] = useState('https://localhost:1234');

    // âœ… useCallbackìœ¼ë¡œ í•¨ìˆ˜ ë©”ëª¨ì´ì œì´ì…˜
    const getOptions = useCallback(() => {
        return {
            serverUrl: serverUrl,
            roomId: roomId,
        };
    }, [serverUrl, roomId]); // ì‹¤ì œ ì˜ì¡´í•˜ëŠ” ê°’ë“¤ë§Œ í¬í•¨

    return <ChatRoom getOptions={getOptions} />;
}
```

> ì´ ê²½ìš° í•¨ìˆ˜ê°€ ìˆœìˆ˜í•˜ì§€ ì•Šì•„ë„ ì‚¬ìš© ê°€ëŠ¥í•˜ë©°, ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ ìì‹ ì»´í¬ë„ŒíŠ¸ ì œì–´ê°€ ê°€ëŠ¥í•´ì§„ë‹¤ëŠ” ì¥ì ì„ ê°–ëŠ”ë‹¤.
